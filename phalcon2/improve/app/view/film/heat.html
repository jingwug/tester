<link href="<?php echo TUrl::instance()->css('index.css'); ?>" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="<?php echo TUrl::instance()->js('index.js'); ?>"></script>
<div class="hr_10"></div>
<div class="wrapper">
	<!--中间部分-->
	<div class="file_mode">
		<div class="film_left left">
			<div class="moviecount">
				<div class="movietab"><a class="hov">正在热映</a><a href="/film/upcoming" >即将上映</a></div>
				<div class="movie_mode" id="_current_fy_movies">
					<div class="mv_clum1">
					<h2>当前<?php echo $city; ?>有<span class="col"><?php echo count($film_info); ?>部</span>电影正在热映</h2>
					<?php $this->partial('film/filmType'); ?>
					</div>
					<div class="selectedMenus">
						<a href="javascript:void(0);" order="attention" class="down_org">热度</a>
						<a href="javascript:void(0);" order="score" class="down_gry">评分</a>
						<a href="javascript:void(0);" order="start_date" class="down_gry">时间</a>
					</div>
					<div class="mv_clum2">
						<ul id="flim_list">
							<?php if($film_info) { ?>
							<?php foreach($film_info as $item) { ?>
							<li class="clearfix">
								<div class="list_pic left">
                                                                    <a href="/film/detail/id/<?php echo $item['id']; ?>" target="_blank" title=""><img alt="<?php echo $item['name']; ?>" src="<?php echo TUrl::instance()->imageUp($item['image']); ?>" width="200px" height="240px"/></a>
									<?php if(isset($item['format'])){ ?>
									<span><?php echo $item['format']; ?></span>
									<?php } ?>
								</div>
								<div class="list_text left">
                                                                    <h2><a target="_blank" title="<?php echo $item['name']; ?>"><?php echo $item['name']; ?></a> <span>(<em class="col"><?php echo $item['attention']; ?></em>人关注 | <em class="col"><?php echo $item['audience']; ?></em>人购票)</span></h2>
									<?php if(isset($item['type'])){ ?>
									<p><span>类型：</span><?php echo $item['type']; ?></p>
									<?php } ?>
									<p><span>语言：</span><?php echo $item['language']; ?></p>
									<p><span>片长：</span><?php echo $item['duration']; ?>分钟</p>
									<p><span>导演：</span><?php echo $item['director']; ?></p>
									<p><span>主演：</span><?php echo $item['actors']; ?></p>
									<p><?php echo $item['cinemas']; ?>家影院上映<span class="col"><?php echo $item['screen']; ?></span>场</p>
								</div>
								<div class="list_scor"><em class="col mg"><b><?php echo $item['score']; ?></b>分</em></div>
                                <div class="list_but right"><a href="/film/detail/id/<?php echo $item['id']; ?>" target="_blank">马上购票</a></div>
							</li>
							<?php } ?>
							<?php } ?>

						</ul>
					</div>
				</div>
			</div>
		</div>
                <?php $this->partial('film/right'); ?>
		<div class="clear"></div>
	</div>
	<!--end-->
</div>
<!-- 板块结束 -->
<div class="hr_20"></div>
<script>

	var FILM = {
		order : 'attention DESC',
        img_upload:"<?php echo TUrl::instance()->imageUp(''); ?>",
		seach:function(order){
			$('#flim_list').html('请稍候……');
			$.ajax({
				type: "POST",
				url: "heatAjax",
				data: {type:$("dd#type a.org").text(), format:$("dd#format a.org").text(), keyword:$("#keyword").val(), order:FILM.order},
				dataType: "json",
				success: function(data){
					var html = '';
					if(data != null){
						$.each(data, function(commentIndex, data){
							html += '<li class="clearfix"> <div class="list_pic left">';
							html += '<a href="'+ data['id'] +'" target="_blank" title=""><img alt="" src="'+FILM.img_upload+data['image'] +'"  width="200px" height="240px"/></a>';
							if(data['format'] && data['format'].length > 0 ){
								html += '<span>'+ data['format'] +'</span></div>';
							}else{
								html += '</div>';
							}
							html += '<div class="list_text left">';
							html += '<h2><a target="_blank" title="'+ data['name'] +'">'+ data['name'] +'</a> <span>(<em class="col">'+ data['attention'] +'</em>人关注 | <em class="col">'+ data['audience'] +'</em>人购票)</span></h2>';
							if(data['type'] && data['type'].length > 0){
								html += '<p><span>类型：</span>'+ data['type'] +'</p>';
							}else{
								html += '<p><span>类型：</span></p>';
							}
							html += '<p><span>语言：</span>'+ data['language'] +'</p>';
							html += '<p><span>片长：</span>'+ data['duration'] +'分钟</p>';
							html += '<p><span>导演：</span>'+ data['director'] +'</p>';
							html += '<p><span>主演：</span>'+ data['actors'] +'</p>';
							html += '<p>'+ data['cinemas'] +'家影院上映<span class="col">'+ data['screen'] +'</span>场</p></div>';
							html += '<div class="list_scor"><em class="col mg"><b>'+ data['score'] +'</b>分</em></div>';
							html += '<div class="list_but right"><a href="/film/detail/id/'+data['id']+'" target="_blank">马上购票</a></div></li>';


						});
					}else{
						html += '<p style="color: red;">没有查询到您要的信息</p>';
					}
					$('#flim_list').html(html);
				},
				error: function (msg) {
					alert('系统出错，请联系客服');
				}

			});

		}
	};
	$(function() {
		$(".selectedMenus a").on("click", function(ev) {
			if($(this).hasClass('down_org')){
				$(this).siblings().attr('class','down_gry').end().attr('class','up_org');
				FILM.order = $(this).attr('order')+' ASC'
			}else{
				$(this).siblings().attr('class','down_gry').end().attr('class','down_org');
				FILM.order = $(this).attr('order')+' DESC'
			}
			FILM.seach();
		});
        $("input[name='keyword']").keyup(function(event) {
            if (event.keyCode == 13) {
               FILM.seach();
            }
        });

        $("input[name='seach_byname']").click(function(event) {

               FILM.seach();

        });

        $("#_current_fy_movies").on("click", "dl.dlTy dd a", function(ev) {
            $(this).addClass("org").siblings("a").removeClass("org");
            FILM.seach();
        });
	});

</script>
